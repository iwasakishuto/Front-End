<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="https://iwasakishuto.github.io/images/apple-touch-icon/front-end.png" />
        <title>JS.4 Canvasで遊んでみる</title>
        <link rel="stylesheet" href="https://iwasakishuto.github.io/Front-End/tips/theme/css/main.css" />

        <!-- Added by Shuto Iwasaki. -->
        <link rel="apple-touch-icon" sizes="152x152" href="https://iwasakishuto.github.io/images/apple-touch-icon/front-end.png" type="image/png" />
        <!-- Use fontawesome Icon -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <!-- Syntax highlight -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/css/custom.css" media="screen">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <!-- LaTex -->
        <!-- Github env -->
        <!--<script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
        <script type="text/x-mathjax-config">
        	MathJax.Hub.Config({
        		tex2jax: {
        			inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        			displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
        		}
        	});
        </script>
        <!-- Mermaid -->
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" charset="UTF-8"></script>
        <script>
          mermaid.initialize({
            startOnLoad:true
          });
        </script>

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://iwasakishuto.github.io/Front-End/tips/">Front-End Portfolio </a></h1>
                <nav><ul>
                    <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/html.html">HTML</a></li>
                    <li class="active"><a href="https://iwasakishuto.github.io/Front-End/tips/category/javascript.html">JavaScript</a></li>
                </ul>
<form id="search" action"#" onsubmit="javascript:window.open('https://duckduckgo.com/?q='+document.getElementById('keywords').value+'+site:https://iwasakishuto.github.io/Front-End/tips');">
                        <input id="keywords" type="text" />
                    </form>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-4.html" rel="bookmark"
           title="Permalink to JS.4 Canvasで遊んでみる">JS.4 Canvasで遊んでみる</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>2019-06-09(日)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->      <p>HTML5から追加された<a href="https://www.w3schools.com/html/html5_canvas.asp">Canvas</a>というものを使って、お絵かきアプリを作成しました。</p>
<p>イベントドリブンのものは <code>jquery</code> で、それ以外のものは直の<code>JavaScript</code>で書いたつもりです。だいぶ <code>JavaScript</code> にも慣れてきた!!</p>
<h2>作ったもの</h2>
<div class="canvas">
  <!-- canvasのサイズを変更する場合、スタイルではなく属性で変更しないとおかしくなる！ -->
  <canvas id="drawing-pad" width="400px" height="400px" style="border: 1.5px solid #000; background-color: #ffffff"></canvas>
  <div>
    <input id="pen-color" type="color" value="#000000">
    color: <span id="color1">#000000</span>
  </div>
  <div>
    <input id="pad-color" type="color" value="#ffffff">
    background-color: <span id="color2">#ffffff</span>
  </div>
  <button id="download" class="btn-blue">download</button>
  <button id="clear-button" class="btn-red">Clear All</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
  // Canvasの情報
  var canvas;
  var context;

  // 線の情報
  var color;

  // ページの読み込みが完了したらコールバック関数が呼ばれる
  window.addEventListener('load', function() {
    canvas = document.querySelector('#drawing-pad');
    context = canvas.getContext('2d');

    const lastPosition = { x: null, y: null }; // nullで初期化。
    let isDrag = false; // 線を描き続けているかを判断するためのフラグ

    var draw = function(x, y){
      if(!isDrag) {
        return;
      }
      /* 線の情報 */
      context.lineCap = 'round';    // 丸みを帯びた線にする
      context.lineJoin = 'round';   // 丸みを帯びた線にする
      context.lineWidth = 5;        // 線の太さ
      context.strokeStyle = color;  // 線の色

      // 開始位置の調整
      if (lastPosition.x === null || lastPosition.y === null) {
        context.moveTo(x, y);
      } else {
        context.moveTo(lastPosition.x, lastPosition.y);
      }
      // 開始位置から現在の位置を線で結ぶ。
      context.lineTo(x, y);

      // 実際に描画する。
      context.stroke();

      // 現在の点を次回の開始点にする。
      lastPosition.x = x;
      lastPosition.y = y;
    }
    var dragStart = function(e) {
      // 描画開始を宣言
      context.beginPath();
      isDrag = true;
    }
    var dragEnd = function(e) {
      // 描画終了を宣言
      context.closePath();
      isDrag = false;

      // 開始点をリセット。
      lastPosition.x = null; lastPosition.y = null;
    }
    // canvas上に書いた絵を全部消す
    var clear = function() {
      context.clearRect(0, 0, canvas.width, canvas.height);
      document.querySelector('#drawing-pad').style.backgroundColor = '#ffffff'; // canvasの背景色
      document.querySelector('#color2').innerHTML = '#ffffff'; // 表示されているカラーコード
      document.querySelector('#color2').style.color = '#ffffff'; // 上の文字色
      document.querySelector('#pad-color').value = '#ffffff'; // ボタンの色
    }

    // マウス操作やボタンクリック時のイベント処理を定義する
    var initEventHandler = function() {
      canvas.addEventListener('mousedown', dragStart); // マウスボタンを押した時。
      canvas.addEventListener('mouseup',   dragEnd);   // マウスボタンを離した時。
      canvas.addEventListener('mouseout',  dragEnd);   // マウスカーソルが外に出た時。
      canvas.addEventListener('mousemove', function(e) { // マウスカーソルが動いた時
        draw(e.layerX, e.layerY);
      });

      const clearButton = document.querySelector('#clear-button');
      clearButton.addEventListener('click', clear);
    }
    // イベント処理を初期化する
    initEventHandler();
  });

  $(function(){
    // ペンの色を変更
    $(function(){
      $('#pen-color').on('change', function(){
        $('#color1').text($('#pen-color').val()).css('color', $('#pen-color').val());
        color = $('#pen-color').val();
      })
    });

    // 背景色を変更
    $('#pad-color').on('change', function(){
      $('#color2').text($('#pad-color').val()).css('color', $('#pad-color').val());
      $('#drawing-pad').css('background-color', $('#pad-color').val());
      // 以下の手法だと、描画した画像が上書きされてしまう！
      // context.fillStyle = $('#pad-color').val();
      // context.fillRect(0, 0, canvas.width, canvas.height);
    })

    // ダウンロード
    $('#download').on('click', function(){
      // メモリ内で新しく画像を描画し、ダウンロードしている。
      var mem_canvas = document.createElement("canvas");
      mem_canvas.width = canvas.width;
      mem_canvas.height = canvas.height;
      var mem_context = mem_canvas.getContext('2d');
      // まず、背景色として指定されている色で塗りつぶす。
      mem_context.fillStyle = $('#pad-color').val();
      mem_context.fillRect(0, 0, canvas.width, canvas.height);
      // 次に、現在描かれている絵(線)をコピーする。
      mem_context.drawImage(canvas,0,0);
      // それをダウンロード。
      let link = document.createElement("a");
      link.href = mem_canvas.toDataURL("image/png");
      link.download = "canvas.png";
      link.click();
    })
  });
</script>

<style>
  .canvas {
    text-align: center;
    margin: 30px auto;
  }
  .btn-blue {
    background-color: rgba(68, 122, 178);
    color: #fff;
    padding: 10px;
    border-radius: 3px;
  }
  .btn-red {
    background-color: rgb(252, 92, 84);
    color: #fff;
    padding: 10px;
    border-radius: 3px;
  }
</style>

<h2>コード</h2>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;canvas&quot;</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- canvasのサイズを変更する場合、スタイルではなく属性で変更しないとおかしくなる！ --&gt;</span>
  <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;drawing-pad&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400px&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;400px&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;border: 1.5px solid #000; background-color: #ffffff&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;pen-color&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;color&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;#000000&quot;</span><span class="p">&gt;</span>
    color: <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;color1&quot;</span><span class="p">&gt;</span>#000000<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;pad-color&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;color&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;#ffffff&quot;</span><span class="p">&gt;</span>
    background-color: <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;color2&quot;</span><span class="p">&gt;</span>#ffffff<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;download&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-blue&quot;</span><span class="p">&gt;</span>download<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;clear-button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-red&quot;</span><span class="p">&gt;</span>Clear All<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="c1">// Canvasの情報</span>
  <span class="kd">var</span> <span class="nx">canvas</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">context</span><span class="p">;</span>

  <span class="c1">// 線の情報</span>
  <span class="kd">var</span> <span class="nx">color</span><span class="p">;</span>

  <span class="c1">// ページの読み込みが完了したらコールバック関数が呼ばれる</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#drawing-pad&#39;</span><span class="p">);</span>
    <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">lastPosition</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="kc">null</span> <span class="p">};</span> <span class="c1">// nullで初期化。</span>
    <span class="kd">let</span> <span class="nx">isDrag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// 線を描き続けているかを判断するためのフラグ</span>

    <span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isDrag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="cm">/* 線の情報 */</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineCap</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">;</span>    <span class="c1">// 丸みを帯びた線にする</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineJoin</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">;</span>   <span class="c1">// 丸みを帯びた線にする</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>        <span class="c1">// 線の太さ</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>  <span class="c1">// 線の色</span>

      <span class="c1">// 開始位置の調整</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lastPosition</span><span class="p">.</span><span class="nx">x</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastPosition</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// 開始位置から現在の位置を線で結ぶ。</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>

      <span class="c1">// 実際に描画する。</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>

      <span class="c1">// 現在の点を次回の開始点にする。</span>
      <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
      <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">dragStart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 描画開始を宣言</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
      <span class="nx">isDrag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">dragEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 描画終了を宣言</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
      <span class="nx">isDrag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="c1">// 開始点をリセット。</span>
      <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// canvas上に書いた絵を全部消す</span>
    <span class="kd">var</span> <span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#drawing-pad&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span> <span class="c1">// canvasの背景色</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#color2&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span> <span class="c1">// 表示されているカラーコード</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#color2&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span> <span class="c1">// 上の文字色</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span> <span class="c1">// ボタンの色</span>
    <span class="p">}</span>

    <span class="c1">// マウス操作やボタンクリック時のイベント処理を定義する</span>
    <span class="kd">var</span> <span class="nx">initEventHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="nx">dragStart</span><span class="p">);</span> <span class="c1">// マウスボタンを押した時。</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span>   <span class="nx">dragEnd</span><span class="p">);</span>   <span class="c1">// マウスボタンを離した時。</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span>  <span class="nx">dragEnd</span><span class="p">);</span>   <span class="c1">// マウスカーソルが外に出た時。</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// マウスカーソルが動いた時</span>
        <span class="nx">draw</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">layerX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerY</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="kr">const</span> <span class="nx">clearButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#clear-button&#39;</span><span class="p">);</span>
      <span class="nx">clearButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">clear</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// イベント処理を初期化する</span>
    <span class="nx">initEventHandler</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// ペンの色を変更</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pen-color&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#color1&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pen-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pen-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
        <span class="nx">color</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pen-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
      <span class="p">})</span>
    <span class="p">});</span>

    <span class="c1">// 背景色を変更</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#color2&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#drawing-pad&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
      <span class="c1">// 以下の手法だと、描画した画像が上書きされてしまう！</span>
      <span class="c1">// context.fillStyle = $(&#39;#pad-color&#39;).val();</span>
      <span class="c1">// context.fillRect(0, 0, canvas.width, canvas.height);</span>
    <span class="p">})</span>

    <span class="c1">// ダウンロード</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#download&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="c1">// メモリ内で新しく画像を描画し、ダウンロードしている。</span>
      <span class="kd">var</span> <span class="nx">mem_canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
      <span class="nx">mem_canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
      <span class="nx">mem_canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">mem_context</span> <span class="o">=</span> <span class="nx">mem_canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
      <span class="c1">// まず、背景色として指定されている色で塗りつぶす。</span>
      <span class="nx">mem_context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pad-color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
      <span class="nx">mem_context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
      <span class="c1">// 次に、現在描かれている絵(線)をコピーする。</span>
      <span class="nx">mem_context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="c1">// それをダウンロード。</span>
      <span class="kd">let</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">mem_canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">&quot;image/png&quot;</span><span class="p">);</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="s2">&quot;canvas.png&quot;</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
    <span class="p">})</span>
  <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="p">.</span><span class="nc">canvas</span> <span class="p">{</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span> <span class="kc">auto</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">.</span><span class="nc">btn-blue</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">178</span><span class="p">);</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">.</span><span class="nc">btn-red</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="mi">252</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">84</span><span class="p">);</span>
    <span class="k">color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h5>blogroll</h5>
                        <ul>
                            <li><a href="https://iwasakishuto.github.io">Home</a></li>
                            <li><a href="https://iwasakishuto.github.io/blog/articles/index.html">Blog</a></li>
                            <li><a href="https://iwasakishuto.github.io/University/index.html">University</a></li>
                            <li><a href="https://iwasakishuto.github.io/Kerasy/doc/index.html">Kerasy</a></li>
                            <li><a href="https://iwasakishuto.github.io/Front-End/index.html">Front-End</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h5>social</h5>
                        <ul>

                            <li><a href="https://twitter.com/cabernet_rock">twitter</a></li>
                            <li><a href="https://github.com/iwasakishuto">github</a></li>
                            <li><a href="https://www.facebook.com/iwasakishuto">facebook</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>