<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Shuto" />
        <meta name="twitter:creator" content="@cabernet_rock">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">
        <title>Shuto's Front-End - Shuto</title>
        <link rel="stylesheet" href="https://iwasakishuto.github.io/Front-End/tips/theme/css/main.css" />

        <!-- Added by Shuto Iwasaki. -->
        <link rel="shortcut icon" href="https://iwasakishuto.github.io/images/apple-touch-icon/Front-End.png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://iwasakishuto.github.io/images/apple-touch-icon/Front-End.png" type="image/png" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/css/custom.css" media="screen">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
        <script type="text/x-mathjax-config">
        	MathJax.Hub.Config({
        		tex2jax: {
        			inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        			displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
        		}
        	});
        </script>
        <!-- Mermaid -->
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" charset="UTF-8"></script>
        <script>
          mermaid.initialize({
            startOnLoad:true
          });
        </script>

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://iwasakishuto.github.io/Front-End/tips/">Shuto's Front-End </a></h1>
                <nav><ul>
                    <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/css.html">CSS</a></li>
                    <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/html.html">HTML</a></li>
                    <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/javascript.html">JavaScript</a></li>
                </ul>
<form id="search" action"#" onsubmit="javascript:window.open('https://duckduckgo.com/?q='+document.getElementById('keywords').value+'+site:https://iwasakishuto.github.io/Front-End/tips');">
                        <input id="keywords" type="text" />
                    </form>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-21.html">JS.21 画像認識用アノテーションツール。</a></h1>
<footer class="post-info">
        <span>2020-11-08(Sun)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info --><ul>
<ul style="list-style: disc; margin-left: 2em;">
  <li><a href="JavaScript-19.html">JS.19</a>で作成したフォトギャラリー</li>
  <li><a href="JavaScript-20.html">JS.20</a>で作成したアノテーションツール</li>
</ul>
<p>を合わせて、画像用のアノテーションツールを作成しました。使い方は以下の通り。</p>
<p>なお、このページはGithub Pagesで作成されている静的サイトのため、アップロードされた画像がサーバー等に送信されることはなく、安心してご利用できます。</p>
<ol style="list-style: decimal; margin-left: 2em;">
  <li><a href="#registration-attrs-form">Registration</a> で属性(<code>attribute</code>)に対する（複数の）ラベル(<code>label</code>)とそれに対応するキー(<code>key</code>)を登録する。</li>
  <li>登録した内容は、<a href="#registered-attrs">Registered Attributes</a>に記載されています。</li>
  <li>全ての属性の登録が済んだら、画像をクリックしてフォトギャラリー状態にする。</li>
  <li>その状態で先ほど登録したキーを入力すれば、対応するラベルが対応する属性に付加される。
    <ul>
      <li>ESC: フォトギャラリーを終了</li>
      <li>→: 次の画像に進む</li>
      <li>←: 前の画像に戻る</li>
    </ul>
  </li>
  <li>download ボタン（画面下部のものと、フォトギャラリー状態で出てくるものは同じです。）を押せば、json形式でラベル化データをダウンロードすることができます。</li>
</ol>
<div class="annotation-attrs">
  <div class="registration-col" style="margin-left: 8%; float: left;">
    <h2>Registration</h2>
    <form id="registration-attrs-form" action="#" onsubmit="return false;">
      <table>
        <thead id="registration-attrs-thead">
          <tr><th colspan="4">Attributes: <input id="attr-name" type="text" class="form-control" placeholder="attribute" required></th></tr>
          <tr>
            <th>Key</th>
            <th>Label</th>
            <th>Copy</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="registration-attrs-tbody">
          <tr>
            <td><input type="text" class="command-key" style="text-align: center;" maxlength="1" size="1"></td>
            <td><input type="text" class="label-name"  placeholder="label name"></td>
            <td><input type="button" value="＋" class="add" tabindex="-1"></td>
            <td><input type="button" value="－" class="del" tabindex="-1"></td>
          </tr>
        </tbody>
        <tbody id="registration-attrs-ttail">
          <tr><td colspan="4">
            <input id="form-reset" type="reset" name="reset" value="Clear"/>
            <input id="form-submit" type="submit" value="Register" onclick="return register_attrs();">
          </td></tr>
        </tbody>
      </table>
    </form>
  </div>
  <div class="registration-col" style="margin-right: 8%; float: right;">
    <h2>Registered Attributes</h2>
    <table id="registered-attrs">
      <thead id="registered-attrs-thead">
        <tr>
          <th>attribute</th>
          <th>label</th>
          <th>command</th>
        </tr>
      </thead>
      <tbody id="registered-attrs-tbody">
      </tbody>
    </table>
  </div>
</div>
<div style='text-align: center; margin-top: 5%;'>
  <label id="InputFilesLabel" for='InputFiles'>
    ディレクトリを選択してください。
    <input id="InputFiles" type="file" webkitdirectory style='display:none;'>
  </label>
</div>
<div style="padding: 10px; text-align: center;">
  画像サイズ（現在<span id="currentSize">12%</span>）：5% <input id="sizeRange" type="range" min="5" max="100" step="1" value="12" />100%
</div>
<ul id="gallery" class="galleryCover"></ul>
<div class="download_wrapper">
  <button class="download_btn" onclick="download_json();">Download JSON</button>
</div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css" rel="stylesheet" />
<script src="https://iwasakishuto.github.io/js/jquery.js" type="text/javascript"></script>
<script>
  /*!
  * Lightbox v2.11.2
  * by Lokesh Dhakar
  *
  * More info:
  * http://lokeshdhakar.com/projects/lightbox2/
  *
  * Copyright Lokesh Dhakar
  * Released under the MIT license
  * https://github.com/lokesh/lightbox2/blob/master/LICENSE
  *
  * @preserve
  */
  /*!
  * Modified by iwasakishuto (2020/11/08)
  * Github : https://github.com/iwasakishuto
  * Twitter: https://twitter.com/cabernet_rock
  */
  var currentImageIndex = -1;
  (function() {
    var a = jQuery,
        b = function() {
          function a() {
            this.fadeDuration = 1, 
            this.fitImagesInViewport = !0, 
            this.resizeDuration = 0, 
            this.positionFromTop = 50, 
            this.showImageNumberLabel = ! 0, 
            this.alwaysShowNavOnTouchDevices = ! 1, 
            this.wrapAround = !1
          }
          return a.prototype.albumLabel = function(a, b) {
            currentImageIndex = a;
            generate_annotation_table()
            return "Image " + a + " of " + b
          }, a
        }(),
        c = function() {
          function b(a) {
            this.options = a, 
            this.album = [], 
            this.currentImageIndex = void 0, 
            this.init()
          }
          return b.prototype.init = function() {
            this.enable(), 
            this.build()
          }, b.prototype.enable = function() {
            var b = this;
            a("body").on("click",
              "a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",
              function(c) {
                return b.start(a(c.currentTarget)), !1
              })
          }, b.prototype.build = function() {
            var b = this;
            a(`
              <div id='lightboxOverlay' class='lightboxOverlay'></div>
              <div id='lightbox' class='lightbox'>
                <div class='lb-outerContainer'>
                  <div class='lb-container'>
                    <img class='lb-image' src='' />
                    <div class='lb-nav'>
                      <a class='lb-prev' href='' ></a>
                      <a class='lb-next' href='' ></a>
                    </div>
                    <div class='lb-loader'>
                      <a class='lb-cancel'></a>
                    </div>
                  </div>
                </div>
                <div class='lb-dataContainer'>
                  <div class='lb-data'>
                    <div class='lb-details'>
                      <span class='lb-caption'></span>
                      <span class='lb-number'></span>
                    </div>
                    <h4 style='color: white!important;'>Current Attributes</h4>
                    <table id='annotation-label' style='color: white;'>
                      <thead id='annotation-label-thead'>
                        <tr>
                          <th>attribute</th>
                          <th>label</th>
                        </tr>
                      </thead>
                      <tbody id='annotation-label-tbody'></tbody>
                    </table>
                    <h3 style='color: #ccc!important;'>Registered Attributes</h3>
                    <table id='registered-attrs-overlay'>
                      <thead id='registered-attrs-thead-overlay'>
                        <tr>
                          <th>attribute</th>
                          <th>label</th>
                          <th>command</th>
                        </tr>
                      </thead>
                      <tbody id='registered-attrs-tbody-overlay'>
                      </tbody>
                    </table>
                    <div class='download_wrapper'>
                      <button class='download_btn' onclick='download_json();'>Download JSON</button>
                    </div>
                    <div class='lb-closeContainer'>
                      <a class='lb-close'></a>
                    </div>
                  </div>
                </div>
              </div>
              `).appendTo(a("body")), 
              this.$lightbox = a("#lightbox"), 
              this.$overlay = a("#lightboxOverlay"), 
              this.$outerContainer = this.$lightbox.find(".lb-outerContainer"), 
              this.$container = this.$lightbox.find(".lb-container"), 
              this.containerTopPadding = parseInt(this.$container.css("padding-top"), 10), 
              this.containerRightPadding = parseInt(this.$container.css("padding-right"), 10), 
              this.containerBottomPadding = parseInt(this.$container.css("padding-bottom"), 10),
              this.containerLeftPadding = parseInt(this.$container.css("padding-left"), 10), 
              this.$overlay.hide().on("click", function() { 
                return b.end(), !1
              }), 
              this.$lightbox.hide().on("click", function(c) {
                return "lightbox" === a(c.target).attr("id") && b.end(), !1
              }), 
              this.$outerContainer.on("click", function(c) {
                return "lightbox" === a(c.target).attr("id") && b.end(), !1
              }), 
              this.$lightbox.find(".lb-prev").on("click", function() {
                return b.changeImage(0 === b.currentImageIndex ? b.album.length - 1 : b.currentImageIndex - 1), !1
              }), 
              this.$lightbox.find(".lb-next").on("click", function() {
                return b.changeImage(b.currentImageIndex === b.album.length - 1 ? 0 : b.currentImageIndex + 1), !1
              }), 
              this.$lightbox.find(".lb-loader, .lb-close").on("click", function() {
                return b.end(), !1
              })
          }, b.prototype.start = function(b) {
            function c(a) {
              d.album.push({
                link: a.attr("href"),
                title: a.attr("data-title") || a.attr("title")
              })
            }
            var d = this,
                e = a(window);
                e.on("resize", a.proxy(this.sizeOverlay, this)), 
                a("select, object, embed").css({visibility: "hidden"}),
                this.sizeOverlay(), 
                this.album = [];
            var f = 0, 
                g = 0,
                h = b.attr("data-lightbox");
            if (h) {
              f = a(b.prop("tagName") + '[data-lightbox="' + h + '"]');
              for (var i = 0; i < f.length; i = ++i) c(a(f[i])), f[i] === b[0] && (g = i)
            } else if ("lightbox" === b.attr("rel")) {
              c(b);
            } else {
              f = a(b.prop("tagName") + '[rel="' + b.attr("rel") + '"]');
              for (var j = 0; j < f.length; j = ++j) c(a(f[j])), f[j] === b[0] && (g = j)
            }
            var k = e.scrollTop() + this.options.positionFromTop,
                l = e.scrollLeft();
            this.$lightbox.css({
              top: k + "px",
              left: l + "px"
            }).fadeIn(this.options.fadeDuration), 
            this.changeImage(g)
          }, b.prototype.changeImage = function(b) {
            var c = this;
            this.disableKeyboardNav();
            var d = this.$lightbox.find(".lb-image");
            this.$overlay.fadeIn(this.options.fadeDuration), 
            a(".lb-loader").fadeIn("slow"), 
            this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),
            this.$outerContainer.addClass("animating");
            var e = new Image;
            e.onload = function() {
              var f, g, h, i, j, k, l;
              d.attr("src", c.album[b].link), 
              f = a(e), 
              d.width(e.width), 
              d.height(e.height),
              c.options.fitImagesInViewport && (
                l = a(window).width(), 
                k = a(window).height(),
                j = l - c.containerLeftPadding - c.containerRightPadding - 20, 
                i = k - c.containerTopPadding - c.containerBottomPadding - 120, 
                (e.width > j || e.height > i) && 
                (e.width / j > e.height / i ? (h = j, g = parseInt(e.height / (e.width / h), 10), d.width(h), d.height(g)) : (g = i, h = parseInt(e.width / (e.height / g), 10), d.width(h), d.height(g)))
              ), 
              c.sizeContainer(d.width(), d.height())
            }, e.src = this.album[b].link, 
              this.currentImageIndex = b
          }, b.prototype.sizeOverlay = function() {
            this.$overlay.width(a(window).width()).height(a(document).height())
          }, b.prototype.sizeContainer = function(a, b) {
            function c() {
              d.$lightbox.find(".lb-dataContainer").width(g), 
              d.$lightbox.find(".lb-prevLink").height(h),
              d.$lightbox.find(".lb-nextLink").height(h),
              d.showImage()
            }
            var d = this,
                e = this.$outerContainer.outerWidth(),
                f = this.$outerContainer.outerHeight(),
                g = a + this.containerLeftPadding + this.containerRightPadding,
                h = b + this.containerTopPadding + this.containerBottomPadding;
            e !== g || f !== h ? this.$outerContainer.animate({
              width: g,
              height: h
            }, this.options.resizeDuration, "swing", function() {
              c()
            }) : c()
          }, b.prototype.showImage = function() {
            this.$lightbox.find(".lb-loader").hide(), 
            this.$lightbox.find(".lb-image").fadeIn("slow"), 
            this.updateNav(), 
            this.updateDetails(), 
            this.preloadNeighboringImages(),
            this.enableKeyboardNav()
          }, b.prototype.updateNav = function() {
            var a = !1;
            try {
              document.createEvent("TouchEvent"),
              a = this.options.alwaysShowNavOnTouchDevices ? !0 : !1
            } catch (b) {}
            this.$lightbox.find(".lb-nav").show(), 
            this.album.length > 1 && (this.options.wrapAround ? (
                a && this.$lightbox.find(".lb-prev, .lb-next").css("opacity", "1"), 
                this.$lightbox.find(".lb-prev, .lb-next").show()
              ) : (
                this.currentImageIndex > 0 && (this.$lightbox.find(".lb-prev").show(),
                a && this.$lightbox.find(".lb-prev").css("opacity", "1")), 
                this.currentImageIndex < this.album.length - 1 && (this.$lightbox.find(".lb-next").show(), 
                a && this.$lightbox.find(".lb-next").css("opacity", "1"))
              )
            )
          }, b.prototype.updateDetails = function() {
            var b = this;
            "undefined" != typeof this.album[this.currentImageIndex].title && "" !==
              this.album[this.currentImageIndex].title && this.$lightbox.find(
                ".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn(
                "fast").find("a").on("click", function() {
                location.href = a(this).attr("href")
              }), this.album.length > 1 && this.options.showImageNumberLabel ? this.$lightbox
              .find(".lb-number").text(this.options.albumLabel(this.currentImageIndex +
                1, this.album.length)).fadeIn("fast") : this.$lightbox.find(
                ".lb-number").hide(), this.$outerContainer.removeClass("animating"),
              this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,
                function() {
                  return b.sizeOverlay()
                })
          }, b.prototype.preloadNeighboringImages = function() {
            if (this.album.length > this.currentImageIndex + 1) {
              var a = new Image;
              a.src = this.album[this.currentImageIndex + 1].link
            }
            if (this.currentImageIndex > 0) {
              var b = new Image;
              b.src = this.album[this.currentImageIndex - 1].link
            }
          }, b.prototype.enableKeyboardNav = function() {
            a(document).on("keyup.keyboard", a.proxy(this.keyboardAction, this))
          }, b.prototype.disableKeyboardNav = function() {
            a(document).off(".keyboard")
          }, b.prototype.keyboardAction = function(a) {
            var b = 27, // <esc>
              c = 37, // ←
              d = 39, // →
              e = a.keyCode;
              // f = String.fromCharCode(e).toLowerCase();
              assign_label(a.key);
              e === b ?
                this.end():
                e === c ? // KeyCode == ←
                  0 !==this.currentImageIndex ? 
                    this.changeImage(this.currentImageIndex - 1) :
                    this.options.wrapAround && this.album.length > 1 && this.changeImage(this.album.length - 1) : 
                  e === d && (this.currentImageIndex !==this.album.length - 1 ? 
                    this.changeImage(this.currentImageIndex + 1) :
                  this.options.wrapAround && this.album.length > 1 && this.changeImage(0)
              )
          }, b.prototype.end = function() {
            this.disableKeyboardNav(), a(window).off("resize", this.sizeOverlay),
              this.$lightbox.fadeOut(this.options.fadeDuration), this.$overlay.fadeOut(
                this.options.fadeDuration), a("select, object, embed").css({
                visibility: "visible"
              })
          }, b
        }();
    a(function() {
      {
        var a = new b;
        new c(a)
      }
    })
  }).call(this);
</script>
<script>
  // Folder Upload.
  var gallery = document.getElementById('gallery');
  var sizeRange = document.getElementById('sizeRange');
  var currentSize = document.getElementById('currentSize');
  var files, file;
  var anno_dataset = {} // annotation dataset.
  var command_keys = {} // command: [attribute_name, label]
  var annotations = {}  // Filepath: {annotation}
  var idx2filepath = {} // ImageIndex: ImageFilePath
  // Change sizes of gallery images.
  sizeRange.addEventListener("change", function(e){
    let size = sizeRange.value + "%";
    currentSize.innerHTML = size;
    let target = document.getElementsByClassName("__canvas");
    for (var i = 0; i < target.length; i++) {
      target[i].style.width = size;
    }
  });
  // Sort files in Uploaded directory, then create all img tags and annotations.
  document.getElementById("InputFiles").addEventListener('change', function(e){
    var img, div;
    var files = [].slice.call(e.target.files)
    // Sort files by file name.
    files.sort(function(a,b){
      if(a.name < b.name) return -1;
      if(a.name > b.name) return 1;
      return 0;
    });
    // Create <img> only for valid images.
    const validImageTypes = ['image/gif', 'image/jpeg', 'image/png'];
    let imgidx = 1;
    for (var i=0; i<files.length; i++) {
      if (validImageTypes.includes(files[i]['type'])){
        let reader = new FileReader();
        // Set file info to reader.
        reader.fileName = files[i].name
        reader.relativePath = files[i].webkitRelativePath
        reader.onload = function(e) {
          var filepath = e.target.relativePath
          var filesrc  = e.target.result
          idx2filepath[imgidx++] = filepath
          // Initialize annotations.
          annotations[filepath] = {}
          //  <img src="e.target.result" class="__canvas">
          img = document.createElement('img');
          img.setAttribute('src', filesrc);
          img.className = '__canvas';
          // <a href="e.target.result" data-title="e.target.name" data-lightbox="photowall">
          a = document.createElement('a');
          a.setAttribute('href', filesrc);
          a.setAttribute('data-title', filepath);
          a.setAttribute('data-lightbox', "photowall")
          a.appendChild(img);
          // <li>
          li = document.createElement('li');
          li.appendChild(a);
          li.className = 'galleryElements';
          gallery.appendChild(li)
        }
        reader.readAsDataURL(files[i]);
      }
    }
  });
  // Add and Delete input tags.
  $(document).on("click", ".add", function() {
    var target = $(this).parent().parent()
    target.clone(true).insertAfter(target);
  });
  $(document).on("click", ".del", function() {
    var target = $(this).parent().parent();
    if (target.parent().children().length > 1) {
      target.remove();
    }
  });
  // Assign label using KeyboardEvent.
  function assign_label(key){
    if (command_keys.hasOwnProperty(key)){
      attr_label = command_keys[key]
      annotations[idx2filepath[currentImageIndex]][attr_label[0]] = attr_label[1]
    }
    generate_annotation_table()
  }
  // Change background-color when input is focused.
  $(function() {
    $('input[type="text"]')
      .focusin(function(e) {
        $(this).css('background-color', '#ffc');
      })
      .focusout(function(e) {
        $(this).css('background-color', '');
      });
  });
  // Register Annotation labels.
  function register_attrs(){
    var attr_name = $("#attr-name")[0].value;
    var msg = "";
    if (attr_name!=""){
      if (attr_name in anno_dataset){
        msg += "[×] ".concat("Attribute ", attr_name, " is already registered.", "\n");
      }else{
        var attrs = {}
        msg += "[○] ".concat("Attribute ", attr_name, " is registered.", "\n");
        $("#registration-attrs-tbody").children("tr").each(function(i, e) {
          let inputs = e.getElementsByTagName("input");
          let key    = inputs[0].value;
          let label  = inputs[1].value;
          if (key!="" && label!=""){
            if (command_keys.hasOwnProperty(key)){
              msg += "\t[×] ".concat(key, " is already used.", "\n");
            }else{
              command_keys[key] = [attr_name, label];
              attrs[key] = label;
              msg += "\t[○] ".concat(key, " is registered to mean label: ", label, "\n");
            }
          }
        });
        anno_dataset[attr_name] = attrs;      
      }
    }else{
      msg += "[×] Please enter 'Attribute name'.\n";
    }
    alert(msg);
    reset_registration_table();
    generate_registered_table();
    // generate_annotation_table();
    return false;
  }
  // Reset Registration Form table.
  function reset_registration_table(){
    $("#form-reset").click();
    del_btns = $("input[class='del']");
    for (let i=0; i<del_btns.length; i++){
      del_btns[i].click();
    }
  }
  // Generate Registered Attributes table.
  function generate_registered_table(){
    var registered_tbody = $("#registered-attrs-tbody");
    var registered_tbody_overlay = $("#registered-attrs-tbody-overlay");
    registered_tbody.empty();
    registered_tbody_overlay.empty()
    for (let attr_name in anno_dataset){
      let attrs = anno_dataset[attr_name];
      let num_labels = Object.keys(attrs).length;
      var row = "";
      var is_attr_added = false;
      for (let key in attrs){
        row += "<tr>"
        if (!is_attr_added){
          row += "<td rowspan='" + num_labels +  "'>" + attr_name + "</td>";
          is_attr_added = true;
        }
        row += "".concat("<td>", attrs[key], "</td>");
        row += "".concat("<td>", key, "</td>");
        row += "</td>"      
      }
      registered_tbody.append(row);
      registered_tbody_overlay.append(row);
    }
  }
  // Generate annotation table.
  function generate_annotation_table(){
    var annotation_tbody = $("#annotation-label-tbody");
    annotation_tbody.empty();
    var row = ""
    for (let attr_name in anno_dataset){
      var label = annotations[idx2filepath[currentImageIndex]][attr_name];
      var label = typeof(label) == "undefined" ? "" : label    
      row += "".concat("<tr>", "<td>", attr_name, "</td>", "<td>", label, "</td>");   
    }
    annotation_tbody.append(row);
  }
  // Download all annotation data as json.
  function download_json(){
    var jsonString = JSON.stringify(annotations, null, '\t');
    var blob = new Blob([jsonString], {type: 'application/json' });
    let link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = 'annotations.json';
    link.click();
  }
</script>
<style>
  .annotation-attrs {
    width:100%;
    height:auto;
  }
  .annotation-attrs:after {
    display: block;
    clear: both;
    content: "";
  }
  .lb-data h4:before, .lb-data h4:after {
    border-color: #c9e2ff;
  }
  .lb-data table#annotation-label {
    border-color: white;
  }
  .lb-data table#annotation-label th, .lb-data table#annotation-label td{
    border-color: white;
  }
  .lb-data table{
    width: 100%;
    border: 2px #ccc solid;
    border-collapse: collapse;
    table-layout: auto;
  }
  .lb-data th, .lb-data td {
    text-align: center;
    vertical-align: middle;
    vertical-align: top;
    border: 1px #ccc solid;
    padding: .8em .5em;
  }
  .registration-col th, .registration-col td {
    text-align: center;
    vertical-align: middle;
  } 
  form#registration-attrs-form table input {
    padding: 8px;
    border-radius: 6px;
    margin: 2px;
  }
  input.add, input#form-submit {
    color: white;
    font-weight: bold;
    background-color: #ffabab;
    border-color: #ffabab;
  }
  input.del, input#form-reset {
    color: white;
    font-weight: bold;
    background-color: #b4b4ff;
    border-color: #b4b4ff;
  }
  tbody#registration-attrs-ttail input {
    width: 40%;
  }
  label#InputFilesLabel {
    font-size: 1.3em;
    color: white;
    background-color:#008db8;
    padding: 6px;
    border-radius: 15px;
  }
  div.download_wrapper{
    text-align: center;
    margin-top: 5%;
  }
  button.download_btn {
    background-color: #38da38;
    border-color: #38da38;
    color: white;
    font-weight: bold;
    padding: 8px;
    border-radius: 6px;
    margin: 2px;
    width: 60%;
  }
  .galleryCover .galleryElements {
    text-align: center;
    display: inline;
  }
  .galleryCover {
    text-align: left;
  }
  img.__canvas {
    width: 12%;
    height: auto;
    margin: 3px;
    border: 5;
  }
  img.__canvas:hover{
    background-color: #eee;
  }
  .lb-outerContainer {
    min-width: 400px!important;
    min-height: auto!important;
  }
  .lightbox .lb-image {
    min-width: 400px!important;
    min-height: auto!important;
  }
  .lb-container img {
    min-width: 400px!important;
    min-height: auto!important;
    height: auto!important;
  }
  .lb-outerContainer{
    height: auto!important;
  }
</style>
<p id="pageTop"><a href="#"><i class="fa fa-chevron-up"></i></a></p>
<script>
  $(function(){
    var topBtn=$('#pageTop');
    topBtn.hide();
    $(window).scroll(function(){
      if($(this).scrollTop()>80){
        topBtn.fadeIn();
      }else{
        topBtn.fadeOut();
      }
    });
    topBtn.click(function(){
      $('body,html').animate({
      scrollTop: 0},500);
      return false;
    });
  });
</script>
<style>
  #pageTop {
    position: fixed;
    bottom: 20px;
    right: 20px;
  }
  #pageTop i {
    padding-top: 6px
  }
  #pageTop a {
    display: block;
    z-index: 999;
    padding: 8px 0 0 0;
    border-radius: 30px;
    width: 35px;
    height: 35px;
    background-color: #008db8;
    color: #fff;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
  }
  #pageTop a:hover {
    text-decoration: none;
    opacity: 0.7;
  }
</style>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-20.html" rel="bookmark"
                           title="Permalink to JS.20 Formの登録内容を可視化する。">JS.20 Formの登録内容を可視化する。</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2020-11-08(Sun)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>Formの登録内容を可視化する。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-20.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-19.html" rel="bookmark"
                           title="Permalink to JS.19 ディレクトリ内の画像をフォトギャラリーで表示する。">JS.19 ディレクトリ内の画像をフォトギャラリーで表示する。</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2020-11-07(Sat)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>ディレクトリ内の画像をフォトギャラリーで表示する。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-19.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-18.html" rel="bookmark"
                           title="Permalink to JS.18 ディレクトリ内の画像を全て表示する。">JS.18 ディレクトリ内の画像を全て表示する。</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-07(Sat)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>ディレクトリ内の画像を全て表示する。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-18.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-17.html" rel="bookmark"
                           title="Permalink to JS.17 アノテーションデータ（バウンディングボックス）作成ツールのコード">JS.17 アノテーションデータ（バウンディングボックス）作成ツールのコード</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-04(Wed)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>アノテーションデータ（バウンディングボックス）作成ツールのコード</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-17.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-16.html" rel="bookmark"
                           title="Permalink to JS.16 アノテーションデータ（バウンディングボックス）作成ツール">JS.16 アノテーションデータ（バウンディングボックス）作成ツール</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-04(Wed)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>アノテーションデータ（バウンディングボックス）作成ツール</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-16.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/css-2.html" rel="bookmark"
                           title="Permalink to css.2 ::befere & ::after">css.2 ::befere & ::after</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-03(Tue)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/css.html">css</a></span>
</footer><!-- /.post-info -->                <p>::befere &amp; ::after</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/css-2.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/html-1.html" rel="bookmark"
                           title="Permalink to html.1 テーブルについて理解する。">html.1 テーブルについて理解する。</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-02(Mon)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/html.html">html</a></span>
</footer><!-- /.post-info -->                <p>テーブルについて理解する。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/html-1.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/css-1.html" rel="bookmark"
                           title="Permalink to css.1 蛍光ペンを引く">css.1 蛍光ペンを引く</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-09-02(Mon)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/css.html">css</a></span>
</footer><!-- /.post-info -->                <p>蛍光ペンを引く。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/css-1.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-15.html" rel="bookmark"
                           title="Permalink to JS.15 ポケモン自己分析を分析してみる">JS.15 ポケモン自己分析を分析してみる</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2019-07-30(Tue)</span>
<span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a></span>
</footer><!-- /.post-info -->                <p>ポケモン自己分析を分析してみた。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-15.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 3
        <a href="https://iwasakishuto.github.io/Front-End/tips/author/shuto2.html">&raquo;</a>
        <a href="https://iwasakishuto.github.io/Front-End/tips/author/shuto3.html">&#8649;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h5>other contents</h5>
                        <ul>
                            <li><a href="https://iwasakishuto.github.io"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Home.png">Home</a></li>
                            <li><a href="https://iwasakishuto.github.io/Blog/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Blog.png">Blog</a></li>
                            <li><a href="https://iwasakishuto.github.io/University/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/University.png">University</a></li>
                            <li><a href="https://iwasakishuto.github.io/Kerasy/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Kerasy.png">Kerasy</a></li>
                            <li><a href="https://iwasakishuto.github.io/Python-Charmers/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Python-Charmers.png">Python-Charmers</a></li>
                            <li><a href="https://iwasakishuto.github.io/Translation-Gummy/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Translation-Gummy.png">Translation-Gummy</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h5>social</h5>
                        <ul>

                            <li><a href="https://twitter.com/cabernet_rock">twitter</a></li>
                            <li><a href="https://github.com/iwasakishuto">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="https://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-164333757-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>