<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Shuto" />
    <meta name="twitter:creator" content="@cabernet_rock">
    <meta name="twitter:site" content="@cabernet_rock">
    <meta property="og:type" content="article" />
    <meta name="twitter:card" content="summary">
    <title>Shuto's Front-End - pokemon</title>
    <link rel="stylesheet" href="https://iwasakishuto.github.io/Front-End/tips/theme/css/main.css" />
    <!-- Added by Shuto Iwasaki. -->
    <link rel="shortcut icon" href="https://iwasakishuto.github.io/images/apple-touch-icon/Front-End.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="https://iwasakishuto.github.io/images/apple-touch-icon/Front-End.png" type="image/png" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://iwasakishuto.github.io/css/custom.css" media="screen">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
    <script type="text/x-mathjax-config">
    	MathJax.Hub.Config({
    		tex2jax: {
    			inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    			displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    		}
    	});
    </script>
    <!-- Mermaid -->
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" charset="UTF-8"></script>
    <script>
      mermaid.initialize({
        startOnLoad:true
      });
    </script>
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body id="index" class="home">
    <header id="banner" class="body">
      <h1><a href="https://iwasakishuto.github.io/Front-End/tips/">Shuto's Front-End </a></h1>
      <nav>
        <ul>
          <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/css.html">CSS</a></li>
          <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/html.html">HTML</a></li>
          <li><a href="https://iwasakishuto.github.io/Front-End/tips/category/javascript.html">JavaScript</a></li>
        </ul>
        <form id="search" action"#" onsubmit="javascript:window.open('https://duckduckgo.com/?q='+document.getElementById('keywords').value+'+site:https://iwasakishuto.github.io/Front-End/tips');">
          <input id="keywords" type="text" />
        </form>
      </nav>
    </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-32.html">JS.32 ポケモンエメラルドでフロンティア マスターを目指す（その４）</a></h1>
          <footer class="post-info">
            <span>2021-04-28(Wed)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info --><h2>バトルファクトリー <div class="overflow-ms"><img src="https://iwasakishuto.github.io/Front-End/tips/theme/images/trainer/overworld/Noland.png"></div></h2>

<div class="rule"><h3>ルール</h3>（出典：<a href="https://wiki.xn--rckteqa2e.com/wiki/バトルファクトリー_(第三世代)">ポケモンWiki</a>）<ul>
  <li>ファクトリーでは自分の手持ちは使わず、レンタルポケモンを使ってバトルする。はじめに、表示される6匹のレンタルポケモンのうち3匹を選択し、手持ちとする。以後、そのポケモンで敵トレーナーと戦って勝てば、任意で敵トレーナーとポケモンを1匹交換することができる。</li>
  <li>ポケモンバトルの前にヒントを教えてもらえる。内容は相手のポケモンの中で重複しているタイプと、相手の大まかな戦型である。</li>
  <li>バトルの合間にポケモンの並び替えはできない。</li>
  <li>7人抜きで1周。3周目と6周目の最後にはダツラとのバトルになる。（以降、3周ごとにダツラとのバトル）</li>
  <li>1周ごとにレンタルポケモンはリセットされる。（次の周回では1からレンタルしなおすことになる。）</li>
</ul></div>

<h3>相手のバトルスタイル</h3>

<table id="factory-battle-style">
  <thead><tr><th>スタイル</th><th>説明</th><th>必要な数</th></tr></thead>
  <tbody>
    <tr><td style="background-color:#F8D4CE">けんこんいってき</td><td>はかいこうせんなどリスクのある技</td><td>2</td></tr>
    <tr><td style="background-color:#FFEEB8">じゅんびばんたん</td><td>つるぎのまいなど能力アップ系の技</td><td>3</td></tr>
    <tr><td style="background-color:#C3E8B5">まだまだこれから</td><td>じこさいせいなど体力回復系の技</td><td>3</td></tr>
    <tr><td style="background-color:#92CEEE">よそくふかのう</td><td>めざめるパワーなどタイプや威力が変わる技</td><td>2</td></tr>
    <tr><td style="background-color:#9EABD6">じっくりじわじわ</td><td>どくどくなど状態異常にする技</td><td>3</td></tr>
    <tr><td style="background-color:#DFC6DE">まずはよわめて</td><td>きんぞくおんなど能力ダウン系の技</td><td>2</td></tr>
    <tr><td style="background-color:#BBBCC2">くもゆきしだい</td><td>にほんばれなど天気を変える技</td><td>2</td></tr>
    <tr><td style="background-color:#FFFFFF">りんきおうへん</td><td>以上の条件に2つ以上当てはまっている</td><td>-</td></tr>
    <tr><td style="background-color:#FFFFFF">じゆうほんぽう</td><td>どの条件にも当てはまらない</td><td>-</td></tr>
  </tbody>
</table>

<form id="factory-setting-form" name="FACTORY">
  <h3>レンタルポケモン</h3>
  <table id="rental-pokemon-form" class="fixed">
    <thead><tr><th colspan="6">ファクトリーの設定</th></tr></thead>
    <tbody>
      <tr>
        <td rowspan="2">連勝数</td>
        <td rowspan="2" class="g1"><input name="winStreak" type="number" min="0" max="9999" value="0" size="3"></td>
        <td style="background-color:#c94663;color:white;" colspan="4">出現ポケモン</td>
      </tr>
      <tr class="thead">
        <td>種類</td><td colspan="2">Rental ID</td><td>個体値</td>
      </tr>
      <tr>
        <td rowspan="2">交換回数</td>
        <td rowspan="2" class="g1"><input name="rentalCount" type="number" min="0" max="9999" value="0" size="3"></td>
        <td rowspan="2">初期レンタル</td><td id="init-rental-former-info">N体</td><td>000~000</td><td>0</td>
      </tr>
      <tr><td id="init-rental-latter-info">(6-N)体</td><td>000~000</td><td>0</td></tr>
      <tr>
        <td>Lv モード</td>
        <td class="g1"><select name="LvlMode"><option value="0">Lv.50</option><option value="8">LV.OPEN</option></select></td>
        <td>一般トレーナー</td><td id="optrainer-info">k戦目</td><td>000~000</td><td>0</td>
      </tr>
      <tr>
        <td>Lv</td>
        <td class="g1"><input name="lv" type="number" min="1" max="100" value="50" size="3"></td>
        <td>ダツラ</td><td id="frontier-brain-info">True</td><td>000~000</td><td>0</td>
      </tr>
    </tbody>
  </table>
</form>

<h3>出現するポケモン</h3>

<div style="width:100%; overflow:auto;" id="rental-pokemon-wrapper">
  <table id="rental-pokemon-table">
    <thead>
      <tr><th>ID</th><th>No</th><th><input type="checkbox"/>ポケモン</th><th>タイプ</th><th>もちもの</th><th>技</th><th>H</th><th>A</th><th>B</th><th>C</th><th>D</th><th>S</th><th>性格</th><th>H</th><th>A</th><th>B</th><th>C</th><th>D</th><th>S</th></tr>
    </thead>
    <tbody id="rental-pokemon-tbody">
    </tbody>
  </table>
</div>

<h3>選出されたポケモン</h3>

<p><a class="btn-correct-ivs" id="js-popup-show">個体値(Individual Values)の訂正</a></p>

<div class="popup" id="js-popup">
  <h3>登録されている個体値</h3>
  <table id="registered-rental-pokemon-table">
    <thead><tr><th>ID</th><th>ポケモン</th><th>もちもの</th><th>IV</th><th>H</th><th>A</th><th>B</th><th>C</th><th>D</th><th>S</th><th>性格</th></tr></thead>
    <tbody id="registered-rental-pokemon-tbody">
    </tbody>
  </table>
</div>

<table id="selected-rental-pokemon-table">
  <thead>
    <tr><th colspan="11">ダメージ計算結果</th></tr>
    <tr><th>ID</th><th>ポケモン</th><th>もちもの</th><th>IV</th><th>H</th><th>S</th><th>技</th><th>技威力</th><th>特性</th><th>威力</th><th>割合</th></tr>
  </thead>
  <tbody id="selected-rental-pokemon-tbody">
  </tbody>
</table>

<!-- Load Scripts. -->

<script type="text/javascript" src="https://iwasakishuto.github.io/js/jquery.js"></script>

<script type="text/javascript" src="https://iwasakishuto.github.io/js/tablefilter.js"></script>

<script type="text/javascript" src="https://iwasakishuto.github.io/Front-End/tips/theme/js/pokeutils.js"></script>

<script type="text/javascript" src="https://iwasakishuto.github.io/js/custom.js"></script>

<script>
  const g2_color = "antiquewhite"
</script>

<!-- Battle Frontier Information expecially about Battle Factory -->

<script>
  const FRONTIER_PARTY_SIZE = 6;
  sFrontierBrainStreakAppearances = {
    factory : [21, 42, 21, 1],
  }
  const does_frontier_brain_appear = function(winStreak, facility="factory"){
    var data = sFrontierBrainStreakAppearances[facility];
    winStreak += data[3];
    return ((winStreak == data[0]) || (winStreak == data[1]) || ((winStreak > data[1]) && ((winStreak-data[1]) % data[2] == 0)))
  }
  const sMoves_TotalPreparation = ['つるぎのまい', 'せいちょう', 'ヨガのポーズ', 'こうそくいどう', 'かげぶんしん', 'かたくなる', 'ちいさくなる', 'からにこもる', 'まるくなる', 'バリアー', 'きあいだめ', 'ドわすれ', 'とける', 'かくばる', 'テクスチャー', 'テクスチャー2', 'はらだいこ', 'じこあんじ', 'じゅうでん', 'よこどり', 'ほたるび', 'コスモパワー', 'てっぺき', 'とおぼえ', 'ビルドアップ', 'めいそう', 'りゅうのまい']
  const sMoves_ImpossibleToPredict = ['ものまね', 'ゆびをふる', 'オウムがえし', 'へんしん', 'みがわり', 'スケッチ', 'のろい', 'プレゼント', 'このゆびとまれ', 'トリック', 'なりきり', 'ねこのて', 'スキルスワップ', 'ほごしょく']
  const sMoves_WeakeningTheFoe = ['すなかけ', 'しっぽをふる', 'にらみつける', 'なきごえ', 'いとをはく', 'いやなおと', 'えんまく', 'スプーンまげ', 'フラッシュ', 'わたほうし', 'うらみ', 'こわいかお', 'あまえる', 'はたきおとす', 'あまいかおり', 'フェザーダンス', 'うそなき', 'きんぞくおん', 'くすぐる']
  const sMoves_HighRiskHighReturn = ['ハサミギロチン', 'つのドリル', 'すてみタックル', 'はかいこうせん', 'カウンター', 'じわれ', 'がまん', 'じばく', 'ゴッドバード', 'だいばくはつ', 'じたばた', 'きしかいせい', 'みちづれ', 'ほろびのうた', 'いたみわけ', 'ミラーコート', 'おきみやげ', 'おんねん', 'からげんき', 'きあいパンチ', 'ブラストバーン', 'ハイドロカノン', 'オーバーヒート', 'ハードプラント', 'サイコブースト', 'ボルテッカー']
  const sMoves_Endurance = ['しろいきり', 'じこさいせい', 'ひかりのかべ', 'くろいきり', 'リフレクター', 'タマゴうみ', 'ねむる', 'まもる', 'みきり', 'こらえる', 'ミルクのみ', 'いやしのすず', 'しんぴのまもり', 'バトンタッチ', 'あさのひざし', 'こうごうせい', 'つきのひかり', 'のみこむ', 'ねがいごと', 'ねをはる', 'マジックコート', 'リサイクル', 'リフレッシュ', 'どろあそび', 'なまける', 'アロマセラピー', 'みずあそび']
  const sMoves_SlowAndSteady = ['うたう', 'ちょうおんぱ', 'かなしばり', 'やどりぎのタネ', 'どくのこな', 'しびれごな', 'ねむりごな', 'でんじは', 'どくどく', 'さいみんじゅつ', 'あやしいひかり', 'へびにらみ', 'どくガス', 'あくまのキッス', 'キノコのほうし', 'クモのす', 'てんしのキッス', 'まきびし', 'いばる', 'くろいまなざし', 'メロメロ', 'アンコール', 'いちゃもん', 'おだてる', 'おにび', 'ちょうはつ', 'あくび', 'ふういん', 'よこどり', 'フラフラダンス', 'くさぶえ', 'とおせんぼ']
  const sMoves_DependsOnTheBattlesFlow = ['すなあらし', 'あまごい', 'にほんばれ', 'あられ', 'ウェザーボール']
  const BattleStyles = ["じゅんびばんたん(3)", "よそくふかのう(2)", "まずはよわめて(2)", "けんこんいってき(2)", "まだまだこれから(3)", "じっくりじわじわ(3)", "くもゆきしだい(2)", "りんきおうへん(&&)", "じゆうほんぽう(-)"];
  const BattleStyleMoves = [sMoves_TotalPreparation, sMoves_ImpossibleToPredict, sMoves_WeakeningTheFoe, sMoves_HighRiskHighReturn, sMoves_Endurance, sMoves_SlowAndSteady, sMoves_DependsOnTheBattlesFlow]
  var BattleStyleMovesFilters = Array(BattleStyles.length).fill("rgx:.*")
  BattleStyleMoves.forEach(function(e,i){
    BattleStyleMovesFilters[i] = "rgx:" + e.join("|")
  })
  const BattleStyleColors = ["#FFEEB8", "#92CEEE", "#DFC6DE", "#F8D4CE", "#C3E8B5", "#9EABD6",  "#BBBCC2"];
  // Fixed Ivs of MyPokemon & OpTrainer(~6th), That of OpTrainer(7th)
  const sFixedIVTable = [
      [3,  6],[6,  9],[9,  12],[12, 15],[15, 18],[21, 31],[31, 31],[31, 31],
  ]
  const GetFactoryMonFixedIV = function(challengeNum, is_last, useBetterRange){
    var a2 = (is_last) ? 1 : 0;
    var a1 = Math.min(challengeNum + (useBetterRange ? 1 : 0), 7);
    return sFixedIVTable[a1][a2];
  }
  const GetMonRange = function(challengeNum, adder, useBetterRange){
    challengeNum = Math.min(challengeNum + (useBetterRange ? 1 : 0), 7);
    return sInitialRentalMonRanges[adder + challengeNum];
  }
  const sInitialRentalMonRanges = [
      // Level 50.
      [110, 199],[162, 266],[267, 371],[372, 467],[468, 563],[564, 659],[660, 755],[372, 849],
      // Open Level.
      [372, 467],[468, 563],[564, 659],[660, 755],[372, 881],[372, 881],[372, 881],[372, 881],
  ]
  const RentalMonsGroupTexts =  [
    'lv50-g1', 'lv50-g2', 'lv50-g3', 'lv50-g4', 'lv50-g5', 'lv50-g6', 'lv50-g7', 'lv50-g8', 
    'open-g1', 'open-g2', 'open-g3', 'open-g4', 'open-g5', 'open-g6', 'open-g7', 'open-g8', 
    'lv50-g1g2', 'lv50-g2g3', 'lv50-g3g4', 'lv50-g4g5', 'lv50-g5g6', 'lv50-g6g7', 'lv50-g7g8', 'lv50-g8g8', 'open-g1g2', 'open-g2g3', 'open-g3g4', 'open-g4g5', 'open-g5g6', 'open-g6g7', 'open-g7g8', 'open-g8g8'
  ]
  const RentalMonsGroupValues = [
    // [lv50] g1 ~ g8
    '>=110 && <=199', '>=162 && <=266', '>=267 && <=371', '>=372 && <=467', 
    '>=468 && <=563', '>=564 && <=659', '>=660 && <=755', '>=372 && <=849', 
    // [open] g1 ~ g8
    '>=372 && <=467', '>=468 && <=563', '>=564 && <=659', '>=660 && <=755', 
    '>=372 && <=881', '>=372 && <=881', '>=372 && <=881', '>=372 && <=881', 
    // [lv50] g1g2 ~ g8g8
    '>=110 && <=266', '>=162 && <=371', '>=267 && <=467', '>=372 && <=563', 
    '>=468 && <=659', '>=564 && <=755', '>=372 && <=849', '>=372 && <=849', 
    // [open] g1g2 ~ g8g8
    '>=372 && <=563', '>=468 && <=659', '>=564 && <=755', '>=372 && <=881', 
    '>=372 && <=881', '>=372 && <=881', '>=372 && <=881', '>=372 && <=881',
  ]
  const GetNumPastRentalsRank = function(rentalCount){
    var ret;
    if (rentalCount < 15)      ret = 0;
    else if (rentalCount < 22) ret = 1;
    else if (rentalCount < 29) ret = 2;
    else if (rentalCount < 36) ret = 3;
    else if (rentalCount < 43) ret = 4;
    else                       ret = 5;
    return ret;
  }
</script>

<!-- Factory Settings -->

<script>
  const factory_setting_form = document.getElementById("factory-setting-form");
  const init_rental_former_info = factory_setting_form.querySelector("td#init-rental-former-info")
  const init_rental_latter_info = factory_setting_form.querySelector("td#init-rental-latter-info")
  const optrainer_info          = factory_setting_form.querySelector("td#optrainer-info")
  const frontier_brain_info     = factory_setting_form.querySelector("td#frontier-brain-info")
  function set_factory_condition(){
    var winStreak             = parseInt(factory_setting_form.winStreak.value);
    var curChallengeBattleNum = winStreak%7;
    var challengeNum          = Math.min(Math.floor(winStreak/7), 7);
    var rentalCount           = parseInt(factory_setting_form.rentalCount.value);
    var rentalRank            = GetNumPastRentalsRank(rentalCount);
    var LvlMode               = parseInt(factory_setting_form.LvlMode.value);
    var monRanges = sInitialRentalMonRanges[LvlMode+challengeNum];
    // Set Level to 50;
    if (LvlMode==0) factory_setting_form.lv.value = 50;
    // Initial Rental Monsters (Former)
    init_rental_former_info.textContent = `${rentalRank}体`;
    init_rental_former_info.nextElementSibling.textContent = GetMonRange(challengeNum, adder=LvlMode, useBetterRange=true).join("~");
    init_rental_former_info.nextElementSibling.nextElementSibling.textContent = GetFactoryMonFixedIV(challengeNum, is_last=false, useBetterRange=true);
    init_rental_former_info.nextElementSibling.style.backgroundColor = init_rental_former_info.nextElementSibling.nextElementSibling.style.backgroundColor = (curChallengeBattleNum==0) ? g2_color : "white";
    // Initial Rental Monsters (latter)
    init_rental_latter_info.textContent = `${FRONTIER_PARTY_SIZE - rentalRank}体`;
    init_rental_latter_info.nextElementSibling.textContent = GetMonRange(challengeNum, adder=LvlMode, useBetterRange=false).join("~");
    init_rental_latter_info.nextElementSibling.nextElementSibling.textContent = GetFactoryMonFixedIV(challengeNum, is_last=false, useBetterRange=false);
    // Opponent Trainer
    optrainer_info.textContent = `${curChallengeBattleNum+1}戦目`;
    optrainer_info.nextElementSibling.textContent = GetMonRange(challengeNum, adder=LvlMode, useBetterRange=false).join("~");
    optrainer_info.nextElementSibling.nextElementSibling.textContent = GetFactoryMonFixedIV(challengeNum, is_last=curChallengeBattleNum==6, useBetterRange=false);
    optrainer_info.nextElementSibling.nextElementSibling.style.backgroundColor = (curChallengeBattleNum==6) ? g2_color : "white";
    // Frontire Brain
    var is_frontier_brain = does_frontier_brain_appear(winStreak, facility="factory")
    frontier_brain_info.textContent = is_frontier_brain ? "○" : "×";
    frontier_brain_info.style.backgroundColor = is_frontier_brain ? g2_color : "white";
    frontier_brain_info.nextElementSibling.textContent = GetMonRange(challengeNum, adder=LvlMode, useBetterRange=false).join("~");
    frontier_brain_info.nextElementSibling.nextElementSibling.textContent = GetFactoryMonFixedIV(challengeNum+2, is_last=false, useBetterRange=false);
    // Filter Table
    flt0_rental_pokemon_table_id_select.value = RentalMonsGroupValues[challengeNum + LvlMode + ((rentalRank>0 && curChallengeBattleNum==0) ? 16 : 0)];
    tf_rental.filter();
  }
  function get_current_fixedIV(){
    var winStreak             = parseInt(factory_setting_form.winStreak.value);
    var curChallengeBattleNum = winStreak%7;
    var challengeNum          = Math.min(Math.floor(winStreak/7), 7);
    var rentalCount           = parseInt(factory_setting_form.rentalCount.value);
    var rentalRank            = GetNumPastRentalsRank(rentalCount);
    var is_frontier_brain = does_frontier_brain_appear(winStreak, facility="factory")
    var fixedIv;
    if (curChallengeBattleNum==0){
      fixedIv = GetFactoryMonFixedIV(challengeNum, is_last=false, useBetterRange=rentalRank>0)
    }else if (curChallengeBattleNum!=6){
      fixedIv = GetFactoryMonFixedIV(challengeNum, is_last=false, useBetterRange=false)
    }else if (!is_frontier_brain){
      fixedIv = GetFactoryMonFixedIV(challengeNum, is_last=true, useBetterRange=false)
    }else{
      fixedIv = GetFactoryMonFixedIV(challengeNum+2, is_last=false, useBetterRange=false);
    }
    return fixedIv;
  }
  var prev_TFselectedRows = []
  var id2fixedIV = {}
  function store_factory_condition(){
    var fixedIv = get_current_fixedIV();
    if (prev_TFselectedRows.length > TFselectedRows.length){
      prev_TFselectedRows.forEach(function(e){
        if (TFselectedRows.indexOf(e)==-1) delete id2fixedIV[e];
      })
    }else{
      TFselectedRows.forEach(function(e){
        if (prev_TFselectedRows.indexOf(e)==-1) id2fixedIV[e] = fixedIv
      })
    }
    prev_TFselectedRows = [...TFselectedRows];
  }
  function generate_registered_pokemons(){
    var lv = parseInt(factory_setting_form.lv.value);
    var id2rowIndex = get_current_id2rowIndex()
    var registered_pokemon_tbody_trs = "";
    var rental_pokemon_trows = rental_pokemon_tbody.querySelectorAll("tr");
    TFselectedRows.forEach(function(e,i){
      let tds = Array.from(rental_pokemon_trows[ id2rowIndex[e] ].querySelectorAll("td"));
      let id = tds[0].textContent;
      let fixedIv = id2fixedIV[id];
      let pokename = tds[RPT_pokenameIdx].textContent;
      let pokedata = POKENAME2DATA[pokename];
      let item = tds[RPT_itemIdx].textContent;
      let nature = tds[RPT_natureIdx].textContent;
      let evals = tds.slice(RPT_evsIdx, RPT_evsIdx+6).map(function(e){return parseInt(e.textContent)});
      let rstats = calculate_statistics(name=pokename, ivals=Array(6).fill(fixedIv), evals=evals, nature=nature, lv=lv);
      let iv_options = [3,6,9,12,15,18,21,31].map(function(e){return `<option${e==fixedIv ? " selected" : ""}>${e}</option>`}).join("")
      registered_pokemon_tbody_trs += `<tr>
        <td>${id}</td>
        <td style="background-image: ${Pname2typeColor(pokename).color};">${Picon_img_create(pokename)}</td>
        <td>${Pitem_img_create(item)}</td>
        <td class="g1"><select name="correct-iv">${iv_options}</select></td>
        ${coloring_by_nature(nature, rstats, 0, tag="td")}
        <td>${nature}</td>
      </tr>`
    })
    registered_rental_pokemon_tbody.innerHTML = registered_pokemon_tbody_trs;
    registered_rental_pokemon_tbody.querySelectorAll(`select[name="correct-iv"]`).forEach(function(e){
      e.addEventListener("change", function() {
        let tr = e.parentElement.parentElement;
        let id = tr.querySelector("td").textContent;
        id2fixedIV[tr.querySelector("td").textContent] = parseInt(e.value);
        // Recalculate the each rstats.
        recalculate_registered_pokemon_rstats();
        recalculate_selected_pokemon_rstats();
      });
    })
  }
  const RRPT_idIdx     = 0;
  const RRPT_rstatsIdx = 4;
  function recalculate_registered_pokemon_rstats(){
    var lv = parseInt(factory_setting_form.lv.value);
    registered_rental_pokemon_tbody.querySelectorAll("tr").forEach(function(e){
      let tds = e.querySelectorAll("td");
      let id = tds[RRPT_idIdx].textContent;
      let fixedIv = id2fixedIV[id];
      let rental_data = RENTAL_POKEMON_LIST[parseInt(id)]
      let pokename = rental_data[Rental_Pokemon_nameIdx];
      let nature   = rental_data[Rental_Pokemon_natureIdx];
      let evals    = rental_data.slice(Rental_Pokemon_evsIdx, Rental_Pokemon_evsIdx+6);
      let rstats = calculate_statistics(name=pokename, ivals=Array(6).fill(fixedIv), evals=evals, nature=nature, lv=lv);
      for (let i=0; i<6; i++){
        tds[RRPT_rstatsIdx+i].textContent = rstats[i];
      }
    })
  }
</script>

<!-- Initialize Rental Pokemon Table. -->

<script>
  // Index for Generated Tables
  const rental_pokemon_table = document.getElementById("rental-pokemon-table");
  const rental_pokemon_tbody = document.getElementById("rental-pokemon-tbody");
  const RPT_pokenameIdx = 2;
  const RPT_itemIdx     = 4;
  const RPT_moveIdx     = 5;
  const RPT_natureIdx   = 12;
  const RPT_evsIdx      = 13;
  // Find out the correspondence between ID and RowIndex. -->
  const get_current_id2rowIndex = function(){
    var id2rowIndex = {}
    rental_pokemon_tbody.querySelectorAll("tr > td:nth-child(1)").forEach(function(e,i){
      id2rowIndex[e.textContent] = i;
    })
    return id2rowIndex
  }
  function load_rental_pokemons(){
    var rental_pokemon_tbody_trs = "";
    RENTAL_POKEMON_LIST.forEach(function(e,i){
      let moves = e.slice(Rental_Pokemon_moveIdx, Rental_Pokemon_moveIdx+4);
      let move_colors = []
      moves.forEach(function(e,i){
        if (!BattleStyleMoves.some(function(lst,j){
          if (lst.indexOf(e)!=-1){
            move_colors[i] = BattleStyleColors[j];
            return true;
          }
        })) move_colors[i] = "#FFFFFF";
      })
      let pname  = e[Rental_Pokemon_nameIdx];
      let iname  = e[Rental_Pokemon_itemIdx];
      let nature = e[Rental_Pokemon_natureIdx];
      let poketypes = Pname2typeColor(pname);
      rental_pokemon_tbody_trs += `<tr>
        <td>${e[Rental_Pokemon_rentalidIdx]}</td>
        <td>${e[Rental_Pokemon_pokedexIdx]}</td>
        <td><label><input type="checkbox"/>${pname}</label></td>
        <td style="background-image: ${poketypes.color}";>${poketypes.string}</td>
        <td>${iname}</td>
        <td style="padding:0">
          <span class="rental-move" style="background-color:${move_colors[0]}">${moves[0]}</span>
          <span class="rental-move" style="background-color:${move_colors[1]}">${moves[1]}</span>
          <span class="rental-move" style="background-color:${move_colors[2]}">${moves[2]}</span>
          <span class="rental-move" style="background-color:${move_colors[3]}">${moves[3]}</span>
        </td>      
        ${coloring_by_nature(nature, [0,0,0,0,0,0], 0, tag="td")}
        <td>${e[Rental_Pokemon_natureIdx]}</td>
        ${coloring_by_nature(nature, e, Rental_Pokemon_evsIdx, tag="td")}
      </tr>`
    })
    rental_pokemon_tbody.innerHTML = rental_pokemon_tbody_trs;
  }
  function filter_rental_pokemon_table(){
    var filtersConfig = {
      btn_reset: true,
      rows_counter: true,
      loader: true,
      status_bar: true,
      responsive: true,
      grid_layout: {
        width: '100%',
      },
      col_0  : 'select', 
      col_3  : 'select',
      col_4  : 'select',
      col_5  : 'select',
      col_12 : 'select',
      col_19 : 'select',
      custom_options: {
        cols: [0,3,5],
        texts: [RentalMonsGroupTexts, POKETYPES, BattleStyles],
        values: [RentalMonsGroupValues, POKETYPES.map(function(e){return "rgx:"+e}), BattleStyleMovesFilters],
        sorts: [false],
      },
      col_types: ['number', 'number', 'string', 'string', 'string', 'string', 'number', 'number', 'number', 'number', 'number', 'number', 'string', 'number', 'number', 'number', 'number', 'number', 'number', 'number'],
      col_widths: ['120px', '50px', '120px', '150px', '135px', '480px', '50px', '50px', '50px', '50px', '50px', '50px', '95px', '50px', '50px', '50px', '50px', '50px', '50px', '90px'],
      extensions:[{name: 'sort'}]
    };
    var tf_rental = new TableFilter('rental-pokemon-table', filtersConfig);
    tf_rental.init();
    initSelectionListeners(tf_rental, c=2, d=0);
    // Improves the appearance when scrolling horizontally.
    document.querySelectorAll("#rental-pokemon-table tr, .grd_headTblCont tr").forEach(function(e,i){
      var thds = e.querySelectorAll("th, td")
      thds[0].classList.add("fixed-tcol");
      thds[1].classList.add("fixed-tcol");
      thds[2].classList.add("fixed-tcol");
    })
    document.querySelector("div.grd_Cont").querySelectorAll("input[type='checkbox']").forEach(function(e,i){
      e.addEventListener("change", function(){
        store_factory_condition();
        generate_selected_pokemon_table();
      })
    })
    return tf_rental
  }
</script>

<script>
  const selected_rental_pokemon_tbody = document.getElementById("selected-rental-pokemon-tbody");
  function generate_selected_pokemon_table(evt){
    var lv = parseInt(factory_setting_form.lv.value);
    var id2rowIndex = get_current_id2rowIndex();
    var selected_rental_pokemon_tbody_trs = "";
    var rental_pokemon_trows = rental_pokemon_tbody.querySelectorAll("tr");
    TFselectedRows.forEach(function(e,i){
      let tds = Array.from(rental_pokemon_trows[ id2rowIndex[e] ].querySelectorAll("td"));
      let id = tds[0].textContent;
      let fixedIv = id2fixedIV[id];
      let pokename = tds[RPT_pokenameIdx].textContent;
      let pokedata = POKENAME2DATA[pokename];
      let item = tds[RPT_itemIdx].textContent;
      let nature = tds[RPT_natureIdx].textContent;
      let evals = tds.slice(RPT_evsIdx, RPT_evsIdx+6).map(function(e){return parseInt(e.textContent)});
      let move_options = tds[RPT_moveIdx].textContent.split("\n").slice(1,5).map(function(e,i){return `<option>${e}</option>`}).join("");
      let ability_options = pokedata.slice(Pdata_abilityIdx, Pdata_abilityIdx+2).map(function(e,i){return e!="" ? `<option>${e}</option>` : ""}).join("");
      let rstats = calculate_statistics(name=pokename, ivals=Array(6).fill(fixedIv), evals=evals, nature=nature, lv=lv);
      selected_rental_pokemon_tbody_trs += `<tr>
        <td>${id}</td>
        <td style="background-image: ${Pname2typeColor(pokename).color};">${Picon_img_create(pokename)}</td>
        <td>${Pitem_img_create(item)}</td>
        <td>${fixedIv}</td>
        <td>${rstats[0]}</td>
        <td>${rstats[5]}</td>
        <td><select name="move">${move_options}</select></td>
        <td><input type="number" size="3"></td>
        <td><select name="ability">${ability_options}</select></td>
        <td></td>
        <td></td>
      </tr>`
    })
    selected_rental_pokemon_tbody.innerHTML = selected_rental_pokemon_tbody_trs;
  }
  const SRPT_idIdx = 0;
  const SRPT_ivIdx = 3;
  const SRPT_HrstatsIdx = 4;
  const SRPT_SrstatsIdx = 5;
  function recalculate_selected_pokemon_rstats(){
    var lv = parseInt(factory_setting_form.lv.value);
    selected_rental_pokemon_tbody.querySelectorAll("tr").forEach(function(e){
      let tds = e.querySelectorAll("td");
      let id = tds[SRPT_idIdx].textContent;
      let fixedIv = id2fixedIV[id];
      let rental_data = RENTAL_POKEMON_LIST[parseInt(id)]
      let pokename = rental_data[Rental_Pokemon_nameIdx];
      let nature   = rental_data[Rental_Pokemon_natureIdx];
      let evals    = rental_data.slice(Rental_Pokemon_evsIdx, Rental_Pokemon_evsIdx+6);
      let rstats = calculate_statistics(name=pokename, ivals=Array(6).fill(fixedIv), evals=evals, nature=nature, lv=lv);
      tds[SRPT_ivIdx].textContent = fixedIv;
      tds[SRPT_HrstatsIdx].textContent = rstats[0];
      tds[SRPT_SrstatsIdx].textContent = rstats[5];
    })
  }
</script>

<!-- On load -->

<script>
  var tf_rental, flt0_rental_pokemon_table_id_select, registered_rental_pokemon_tbody;
  window.onload = function(){
    // Pop-Up-Event
    var popuplists = document.getElementsByClassName("popup");
    for(let i=0; i<popuplists.length; i++){
      let e = popuplists[i];
      let id = e.id;
      let e_s = document.getElementById(id + "-show")
      if (e_s != null){
        e.innerHTML = `
          <div class="popup-inner">
            <div class="close-btn"><i class="fas fa-times"></i></div>
            ${e.innerHTML}
          </div>
          <div class="black-background"></div>
        `
        addPopupEvent(id);
      }
    }
    registered_rental_pokemon_tbody = document.getElementById("registered-rental-pokemon-tbody");
    function addPopupEvent(id){
      var t = document.getElementById(id);      
      function togglePopUp(e) {
        if (e){
          e.addEventListener('click', function() {
            generate_registered_pokemons();
            t.classList.toggle('is-show');
          });
        }
      }
      togglePopUp(t.querySelector(".black-background"));
      togglePopUp(t.querySelector(".close-btn"));
      togglePopUp(document.getElementById(id + "-show"));
    }
    for (let i=0; i<factory_setting_form.length; i++){
      factory_setting_form[i].addEventListener("change", set_factory_condition)
    }
    // Battle Factory
    // var rental_pokemon_form = document.querySelectorAll("form#factory_setting_form table#rental-pokemon-form select");
    // for(let i=0; i<rental_pokemon_form.length; i++){
    //   let e = rental_pokemon_form[i];
    //   e.addEventListener('change', function(){
    //     set_factory_condition(document.FACTORY);
    //   });
    // }
    load_rental_pokemons();
    tf_rental = filter_rental_pokemon_table();
    flt0_rental_pokemon_table_id_select = document.getElementById("flt0_rental-pokemon-table");
    set_factory_condition();

  }
</script>

<!-- Stylesheet -->

<style>
  table#rental-pokemon-form *,
  table#selected-rental-pokemon-table *,
  table#registered-rental-pokemon-table *{
    vertical-align: middle;
    text-align: center;
  }
  table#rental-pokemon-form select, 
  table#rental-pokemon-form input,
  table#selected-rental-pokemon-table select,
  table#selected-rental-pokemon-table input,
  table#registered-rental-pokemon-table select{
    padding: .5em .4em;
    border: 0;
    background-color: transparent;
    font-family: Monaco, monospace, sans-serif;
  }
  table#rental-pokemon-table select,
  table#selected-rental-pokemon-table select,
  table#registered-rental-pokemon-table select{
    width: 100%;
  }
  div.overflow-ms{
    width: 32px;
    height: 32px;
    overflow: visible;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }
  div.overflow-ms img {
    border: 0!important;
    margin: 0!important;
    padding: 0 !important;
    width: 200%!important;
    vertical-align: middle;
  }
  table.fixed{
    table-layout: fixed;
  }
  .fixed-tcol {
    position: sticky;
    left: 0;
    color: #fff;
    background: #333;
  }
  thead, tr.thead {
    background-color: black;
    color: white;
  }
  thead input {
    color: white;
  }
  table.TF th, summary.h2 {
    background-color: black!important;
    color: white!important;
  }
  ul {
    margin: 1em;
    border: black 1px solid;
    padding: .5em .5em .5em 2.5em;
  }
  ol, ul {
    list-style: decimal;
  }
  span.rental-move {
    width: 120px;
    display: table-cell;
    padding: 7px 9.8px 8.8px 9.8px;
  }
  .g1{
    background-color: lightgoldenrodyellow;
  }
  .g2 {
    background-color: antiquewhite;
  }
</style>

<!-- PopUp -->

<style>
  .popup {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: .6s;
  }
  .popup.is-show {
    opacity: 1;
    visibility: visible;
  }
  .popup-inner {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    max-width: 80%;
    min-width: 60%;
    max-height: 80%;
    overflow: auto;
    padding: 50px;
    background-color: #fff;
    z-index: 2;
  }
  .popup-inner img {
    width: 100%;
  }
  .close-btn {
    position: absolute;
    right: 0;
    top: 0;
    width: 50px;
    height: 50px;
    line-height: 50px;
    text-align: center;
    cursor: pointer;
  }
  .close-btn i {
    font-size: 40px;
    color: #333;
    border: 3px solid;
    border-radius: 50%;
    width: 40px;
  }
  .black-background {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,.8);
    z-index: 1;
    cursor: pointer;
  }
  .btn-correct-ivs {
    position: relative;
    display: inline-block;
    font-weight: bold;
    text-decoration: none;
    color: #fff!important;
    text-shadow: 0 0 5px rgb(255 255 255 / 73%);
    background: #da5a76;
    border-top: solid 3px #da5a76;
    border-bottom: solid 3px #c94663;
    transition: .4s;
    padding: 4px 7px!important;
    border-radius: 10px;
    cursor: pointer;
  }
  .btn-correct-ivs:hover {
    text-shadow: -6px 0px 15px rgba(255, 255, 240, 0.83),
                  6px 0px 15px rgba(255, 255, 240, 0.83);
    text-decoration: none;
  }
</style>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-31.html" rel="bookmark"
                           title="Permalink to JS.31 ポケモンしりとりクイズ">JS.31 ポケモンしりとりクイズ</a></h1>
                </header>

                <div class="entry-content">
          <footer class="post-info">
            <span>2021-04-24(Sat)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info -->                <p>ポケモンしりとりクイズで遊ぼう。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-31.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-28.html" rel="bookmark"
                           title="Permalink to JS.28 ポケモンエメラルドでフロンティア マスターを目指す（その３）">JS.28 ポケモンエメラルドでフロンティア マスターを目指す（その３）</a></h1>
                </header>

                <div class="entry-content">
          <footer class="post-info">
            <span>2021-02-21(Sun)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info -->                <p>ポケモンエメラルドでフロンティア マスターを目指す（その３）</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-28.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-27.html" rel="bookmark"
                           title="Permalink to JS.27 ポケモンエメラルドでフロンティア マスターを目指す（その２）">JS.27 ポケモンエメラルドでフロンティア マスターを目指す（その２）</a></h1>
                </header>

                <div class="entry-content">
          <footer class="post-info">
            <span>2021-02-18(Thu)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info -->                <p>ポケモンエメラルドでフロンティア マスターを目指す（その２）</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-27.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-25.html" rel="bookmark"
                           title="Permalink to JS.25 ポケモンエメラルドでフロンティア マスターを目指す（その１）">JS.25 ポケモンエメラルドでフロンティア マスターを目指す（その１）</a></h1>
                </header>

                <div class="entry-content">
          <footer class="post-info">
            <span>2021-02-15(Mon)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info -->                <p>ポケモンエメラルドでフロンティア マスターを目指す（その１）</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-25.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-15.html" rel="bookmark"
                           title="Permalink to JS.15 ポケモン自己分析を分析してみる">JS.15 ポケモン自己分析を分析してみる</a></h1>
                </header>

                <div class="entry-content">
          <footer class="post-info">
            <span>2019-07-30(Tue)</span>
            <span>| tags: <a href="https://iwasakishuto.github.io/Front-End/tips/tag/javascript.html">JavaScript</a>, <a href="https://iwasakishuto.github.io/Front-End/tips/tag/pokemon.html">pokemon</a></span>
          </footer><!-- /.post-info -->                <p>ポケモン自己分析を分析してみた。</p>
                <a class="readmore" href="https://iwasakishuto.github.io/Front-End/tips/JavaScript-15.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
    <section id="extras" class="body">
      <div class="blogroll">
        <h5>other contents</h5>
        <ul>
          <li><a href="https://iwasakishuto.github.io"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Home.png">Home</a></li>
          <li><a href="https://iwasakishuto.github.io/Blog/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Blog.png">Blog</a></li>
          <li><a href="https://iwasakishuto.github.io/University/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/University.png">University</a></li>
          <li><a href="https://iwasakishuto.github.io/Kerasy/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Kerasy.png">Kerasy</a></li>
          <li><a href="https://iwasakishuto.github.io/Python-Charmers/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Python-Charmers.png">Python-Charmers</a></li>
          <li><a href="https://iwasakishuto.github.io/Translation-Gummy/index.html"><img class="social-img" src="https://iwasakishuto.github.io/images/apple-touch-icon/Translation-Gummy.png">Translation-Gummy</a></li>
        </ul>
      </div><!-- /.blogroll -->
      <div class="social">
        <h5>social</h5>
        <ul>
          <li><a href="https://twitter.com/cabernet_rock">twitter</a></li>
          <li><a href="https://github.com/iwasakishuto">github</a></li>
        </ul>
      </div><!-- /.social -->
    </section><!-- /#extras -->

    <footer id="contentinfo" class="body">
      <p>Powered by <a href="https://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
    </footer><!-- /#contentinfo -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-164333757-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </body>
</html>